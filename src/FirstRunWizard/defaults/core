// ~/.csxx/core.nsh is executed by dotnet-shell for all interactive shells.
// see https://github.com/dotnet-shell/ExampleScripts for more examples

// Default includes
using System.Runtime.InteropServices;
using System.Drawing;
using Dotnet.Shell.UI;

// Custom prompt handling, this handler autodetects if powerline is availiable on Linux environments
// Otherwise if falls back to an acceptable default
bool? powerline = null;

Shell.Prompt = () => 
{
    return new ColorString(" " + Shell.WorkingDirectory + ">", Color.Blue) + " ";
};

Shell.Paths.Add("C:\\Windows");
Shell.Paths.Add("C:\\Windows\\System32");


// Load user functions store in homedir
var functionsDir = Path.Combine(Shell.HomeDirectory, Shell.DefaultScriptExtension, "functions");
if (Directory.Exists(functionsDir))
{
    var functions = new List<string>();
    functions.AddRange(Directory.GetFiles(functionsDir, "*.csx*"));
    functions.AddRange(Directory.GetFiles(functionsDir, "*"+Shell.DefaultScriptExtension));

    foreach (var file in functions.OrderBy(q => q))
    {
        Console.WriteLine(new ColorString($"Loading script - {file}", Color.Teal).TextWithFormattingCharacters);
        #load $file$
    }
}

// Load user command/script aliases
var aliasesFile = Path.Combine(Shell.HomeDirectory, Shell.DefaultScriptExtension, "aliases"+Shell.DefaultScriptExtension);
if (File.Exists(aliasesFile))
{
    #load $aliasesFile$
}

if (RuntimeInformation.IsOSPlatform(OSPlatform.Windows))
{
    Console.WriteLine(new ColorString("This OS is currently in beta!", Color.Red).TextWithFormattingCharacters);
}

// Ensure we start in the users homedir
cd ~
